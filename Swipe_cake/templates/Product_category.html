{% extends 'adminbase.html' %} 
{% load static %}
{% block title %}Admin|Products {% endblock %}
{% block content %}



 
      <!-- partial -->
      <div class="main-panel">
        <div class="content-wrapper">
          
          <div class="row">
            <div class="col-xl-12 col-sm-12 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <div class="row">
                    <div class="col-6">
                      <div class="d-flex align-items-center align-self-start">
                        <h3 class="mb-0">PRODUCTS</h3>
                        <a href="{% url 'categoryadd' %}" class='btn btn-success ml-auto'>Add category</a>
                       
                      </div> 
                      <div class="table-responsive">
                        <table class="table table-hover">
                          <thead>
                            <tr>
                              <th scope="col">Category_Id</th>
                              
                              <th scope="col">Category_name</th>
                            
                              <th scope="col">Stock</th>
                              
                            
                            </tr>
                          </thead>
                         <tbody>
                           {% for p in category %}
                              <tr>
                                <td>{{ forloop.counter}}</td>
                    
                                <td>{{ p.category_name }}</td>
                               
                                <td>{{ p.category_quantity }}</td>

                                <td><a href="{% url 'categoryupdate' p.category_id %}" class='btn btn-warning ml-auto'>Update</a></td>
                                
                                <td>
                                  <form method="post" action="{% url 'Category_delete' p.category_id %}">
                                      {% csrf_token %}
                                      <button type="submit" class="btn btn-danger ml-auto">Delete</button>
                                  </form>
                              </td> 
                              


                              </tr>
                    </div>
                    {% endfor %}
                </tbody>
 
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <script>
    {% block script %}
        document.querySelectorAll('.toggle-button').forEach(button => {
            button.addEventListener('click', function () {
                var userId = $(this).data('userid');
                var attribute = $(this).data('attribute');
                var url = `/toggle_user_attribute/${userId}/${attribute}/`;
    
                // Send an AJAX POST request to the Django view
                fetch(url, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'Content-Type': 'application/json',
                    },
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Network response was not ok');
                    }
                })
                .then(data => {
                    if (data.success) {
                        // Update the button text and style based on the response
                        if (data.new_value) {
                            this.textContent = `Unset ${attribute.charAt(0).toUpperCase() + attribute.slice(1)}`;
                            this.classList.remove('btn-success');
                            this.classList.add('btn-danger');
                        } else {
                            this.textContent = `Set ${attribute.charAt(0).toUpperCase() + attribute.slice(1)}`;
                            this.classList.remove('btn-danger');
                            this.classList.add('btn-success');
                        }
                    } else {
                        console.error('Error updating user attribute:', data.error);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });
        });
    {% endblock script %}
    </script>
    

  {% endblock content %}